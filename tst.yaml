metadata:
  creationTimestamp: null
  labels:
    app: basicservice-op-nginx-svc
    deployment.harmonycloud.cn/selector: basicservice-op-nginx-svc
    labels.harmonycloud.cn/accessapiserver: 'true'
    labels.harmonycloud.cn/app: basicservice-op-nginx-svc
    labels.harmonycloud.cn/downstream: lvs
    labels.harmonycloud.cn/nlbToNginxService: 'true'
    labels.harmonycloud.cn/proxy: 'true'
    labels.harmonycloud.cn/version: v1
    nephele/ingressNginx: 'true'
    pod-template-hash: 6479c486fb
    rp_filter: close
    version: v1
  annotations:
    nephele/nginxContainers: '["nginx"]'
    nephele/nginxUpstream: >-
      [{"name":"basicservice-pdsapi-svc","ports":[8080]},{"name":"basicservice-opapi-svc","ports":[8080]},{"name":"basicservice-abroadbasicsvc-svc","ports":[8080]},{"name":"basicservice-abroadconsoleapi-svc","ports":[8080]},{"name":"basicservice-smsengine-svc","ports":[8080]},{"name":"basicservice-deviceopservice-svc","ports":[9194]},{"name":"basicservice-basapi-svc","ports":[8080]},{"name":"basicservice-basop-svc","ports":[8080]},{"name":"basicservice-webtv-svc","ports":[8080]},{"name":"basicservice-opconsole-svc","ports":[8080]}]
    pod.harmonycloud.cn/logDeployName: basicservice-op-nginx-svc
    unsafe-sysctls.security.jucloud.cn/nginx: >-
      net.ipv4.ip_forward=0,net.ipv4.conf.all.arp_ignore=1,net.ipv4.conf.all.arp_announce=2,net.ipv4.conf.tunl0.arp_ignore=1,net.ipv4.conf.tunl0.arp_announce=2,net.ipv4.conf.all.rp_filter=0,net.ipv4.conf.tunl0.rp_filter=0
spec:
  volumes:
    - name: vol-hp-7c066e3f24fe2d011b729eebff47c1f223bf8644
      hostPath:
        path: /var/log/jucloud/core/
        type: ''
    - name: nginx-json-storage-log-ad8a4a34
      hostPath:
        path: >-
          /var/log/jucloud/basics-tenant-basicservice/basicservice-op-nginx-svc/usr/local/fountain/3rdparty/nginx/logs/
        type: ''
    - name: host-storage-log-684cd25d
      hostPath:
        path: >-
          /var/log/jucloud/basics-tenant-basicservice/basicservice-op-nginx-svc/usr/local/fountain/3rdparty/nginx/conf/servers
        type: ''
    - name: host-storage-log-57828048
      hostPath:
        path: >-
          /var/log/jucloud/basics-tenant-basicservice/basicservice-op-nginx-svc/var/log/supervisor
        type: ''
    - name: nginx-ae3157c16d45ff1670c0
      configMap:
        name: nginx-ae3157c16d45ff1670c0
        items:
          - key: file0
            path: conf/nginx.conf
            mode: 420
          - key: file1
            path: conf/server.conf
            mode: 420
          - key: file2
            path: logrotate.d/nginxproxylog
            mode: 420
          - key: file3
            path: cron.d/logrotate
            mode: 420
          - key: file4
            path: conf/upstream.conf
            mode: 420
        defaultMode: 420
  containers:
    - name: nginx
      image: '172.30.47.164:40080/yunti-tenant--hiproxy-repo/nginx:rel_1.1.3.8_29'
      ports:
        - containerPort: 1988
          protocol: TCP
        - containerPort: 443
          protocol: TCP
        - containerPort: 80
          protocol: TCP
        - containerPort: 8080
          protocol: TCP
        - containerPort: 8082
          protocol: TCP
      env:
        - name: PATH
          value: '/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'
        - name: TERM
          value: xterm
        - name: LANG
          value: en_US.UTF-8
        - name: JUCLOUD_POD_IP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.podIP
        - name: JUCLOUD_ID
          value: '9'
      resources:
        limits:
          cpu: '4'
          memory: 4Gi
        requests:
          cpu: 100m
          memory: 128Mi
      volumeMounts:
        - name: vol-hp-7c066e3f24fe2d011b729eebff47c1f223bf8644
          mountPath: /var/log/jucloud/core/
        - name: nginx-json-storage-log-ad8a4a34
          mountPath: /usr/local/fountain/3rdparty/nginx/logs/
        - name: host-storage-log-684cd25d
          mountPath: /usr/local/fountain/3rdparty/nginx/conf/servers
        - name: host-storage-log-57828048
          mountPath: /var/log/supervisor
        - name: nginx-ae3157c16d45ff1670c0
          mountPath: /usr/local/fountain/3rdparty/nginx/conf/nginx.conf
          subPath: conf/nginx.conf
        - name: nginx-ae3157c16d45ff1670c0
          mountPath: /usr/local/fountain/3rdparty/nginx/conf/server.conf
          subPath: conf/server.conf
        - name: nginx-ae3157c16d45ff1670c0
          mountPath: /etc/logrotate.d/nginxproxylog
          subPath: logrotate.d/nginxproxylog
        - name: nginx-ae3157c16d45ff1670c0
          mountPath: /etc/cron.d/logrotate
          subPath: cron.d/logrotate
        - name: nginx-ae3157c16d45ff1670c0
          mountPath: /usr/local/fountain/3rdparty/nginx/conf//upstream.conf
          subPath: conf/upstream.conf
      livenessProbe:
        tcpSocket:
          port: 80
        initialDelaySeconds: 30
        timeoutSeconds: 10
        periodSeconds: 10
        successThreshold: 1
        failureThreshold: 30
      readinessProbe:
        httpGet:
          path: /health
          port: 80
          scheme: HTTP
        initialDelaySeconds: 10
        timeoutSeconds: 15
        periodSeconds: 10
        successThreshold: 1
        failureThreshold: 15
      lifecycle:
        preStop:
          exec:
            command:
              - /bin/sh
              - '-c'
              - sleep 28
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      imagePullPolicy: IfNotPresent
      securityContext:
        capabilities:
          add:
            - NET_BIND_SERVICE
            - NET_ADMIN
            - SYS_PTRACE
            - CHOWN
            - DAC_OVERRIDE
            - FOWNER
            - FSETID
            - KILL
            - SETPCAP
            - NET_RAW
            - SYS_CHROOT
            - AUDIT_WRITE
            - SETFCAP
          drop:
            - ALL
        privileged: false
        runAsNonRoot: true
  restartPolicy: Always
  terminationGracePeriodSeconds: 30
  dnsPolicy: ClusterFirst
  serviceAccountName: sa-for-apiserver
  serviceAccount: sa-for-apiserver
  securityContext:
    sysctls:
      - name: net.core.somaxconn
        value: '20480'
      - name: net.ipv4.ip_forward
        value: '0'
      - name: net.ipv4.conf.all.arp_ignore
        value: '1'
      - name: net.ipv4.conf.all.arp_announce
        value: '2'
      - name: net.ipv4.conf.tunl0.arp_ignore
        value: '1'
      - name: net.ipv4.conf.tunl0.arp_announce
        value: '2'
      - name: net.ipv4.conf.all.rp_filter
        value: '0'
      - name: net.ipv4.conf.tunl0.rp_filter
        value: '0'
  imagePullSecrets:
    - name: account-dev-secret
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: labels.harmonycloud.cn/opnginx
                operator: In
                values:
                  - isNginxforOP
              - key: labels.harmonycloud.cn/idc
                operator: In
                values:
                  - aws
              - key: tenant.jucloud.cn/all
                operator: In
                values:
                  - 'true'
    podAffinity: {}
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: deployment.harmonycloud.cn/selector
                  operator: In
                  values:
                    - basicservice-op-nginx-svc
            topologyKey: kubernetes.io/hostname
  schedulerName: default-scheduler
  tolerations:
    - key: test
      value: testvalue
      effect: NoSchedule

  taints:
    effect: NoSchedule
    key: opnginx
    value: isNginxforOP


  tolerations:
  - key: nginx-node
    operator: Equal
    effect: NoSchedule



